<template id="biometric_attendance_monthly_register_report">
    <t t-call="web.external_layout">
        <t t-call="web.html_container">
            <div class="article" t-att-data-oe-model="'biometric.attendance.log'" t-att-data-oe-id="ids[0]"
                 style="max-width: 100%; margin: 0; padding: 0;">
                <!-- Report Header -->
                <div class="row mb-4">
                    <div class="col-12 text-center">
                        <h2>Monthly Attendance Register</h2>
                        <h5>Period: <t t-esc="from_date.strftime('%d-%m-%Y')"/> to <t t-esc="to_date.strftime('%d-%m-%Y')"/></h5>
                    </div>
                </div>

                <!-- Main Table -->
                <table class="table table-sm table-bordered" style="width: 100%; font-size: 10px; page-break-inside: avoid;">
                    <thead>
                        <tr style="background-color: #f2f2f2;">
                            <th rowspan="2" style="vertical-align: middle; width: 120px;">Employee</th>
                            <!-- Days of month -->
                            <t t-foreach="range(1, days_in_month + 1)" t-as="day">
                                <th style="text-align: center; width: 20px;">
                                    <t t-esc="day"/>
                                </th>
                            </t>
                            <th colspan="4" style="text-align: center;">Summary</th>
                        </tr>
                        <tr style="background-color: #f2f2f2;">
                            <!-- Day of week abbreviations -->
                            <t t-foreach="range(1, days_in_month + 1)" t-as="day">
                                <t t-set="current_date" t-value="datetime.date(from_date.year, from_date.month, day)"/>
                                <th style="text-align: center; font-size: 8px;">
                                    <t t-esc="current_date.strftime('%a')[:2]"/>
                                </th>
                            </t>
                            <th style="text-align: center;">P</th>
                            <th style="text-align: center;">A</th>
                            <th style="text-align: center;">L</th>
                            <th style="text-align: center;">Hrs</th>
                        </tr>
                    </thead>
                    <tbody>
                        <t t-foreach="get_employees()" t-as="employee">
                            <tr>
                                <td style="vertical-align: middle;"><t t-esc="employee.name"/></td>

                                <!-- Loop through each day of the month -->
                                <t t-set="present_count" t-value="0"/>
                                <t t-set="absent_count" t-value="0"/>
                                <t t-set="leave_count" t-value="0"/>
                                <t t-set="total_hours" t-value="0.0"/>

                                <t t-foreach="range(1, days_in_month + 1)" t-as="day">
                                    <t t-set="current_date" t-value="datetime.date(from_date.year, from_date.month, day)"/>
                                    <t t-set="attendance" t-value="get_employee_attendance(employee, current_date)"/>

                                    <td style="text-align: center; vertical-align: middle; font-weight: bold;">
                                        <t t-if="attendance.get('status') == 'P'">
                                            <span style="color: green;">✓</span>
                                            <t t-set="present_count" t-value="present_count + 1"/>
                                            <t t-set="total_hours" t-value="total_hours + attendance.get('hours', 0.0)"/>
                                        </t>
                                        <t t-elif="attendance.get('status') == 'A'">
                                            <span style="color: red;">✗</span>
                                            <t t-set="absent_count" t-value="absent_count + 1"/>
                                        </t>
                                        <t t-elif="attendance.get('status') == 'L'">
                                            <span style="color: orange;">L</span>
                                            <t t-set="leave_count" t-value="leave_count + 1"/>
                                        </t>
                                        <t t-elif="is_weekend(current_date)">
                                            <span style="color: blue;">W</span>
                                        </t>
                                        <t t-else="">
                                            <span style="color: gray;">-</span>
                                            <t t-set="absent_count" t-value="absent_count + 1"/>
                                        </t>
                                    </td>
                                </t>

                                <!-- Summary columns -->
                                <td style="text-align: center; background-color: #e6ffe6;"><t t-esc="present_count"/></td>
                                <td style="text-align: center; background-color: #ffe6e6;"><t t-esc="absent_count"/></td>
                                <td style="text-align: center; background-color: #fff2e6;"><t t-esc="leave_count"/></td>
                                <td style="text-align: center; background-color: #e6f2ff;"><t t-esc="'{:.1f}'.format(total_hours)"/></td>
                            </tr>
                        </t>
                    </tbody>
                </table>

                <!-- Legend -->
                <div class="row mt-3">
                    <div class="col-12">
                        <h6>Legend:</h6>
                        <span style="color: green; font-weight: bold;">✓</span> = Present &nbsp;&nbsp;
                        <span style="color: red; font-weight: bold;">✗</span> = Absent &nbsp;&nbsp;
                        <span style="color: orange; font-weight: bold;">L</span> = Leave &nbsp;&nbsp;
                        <span style="color: blue; font-weight: bold;">W</span> = Weekend &nbsp;&nbsp;
                    </div>
                </div>

                <!-- Signature Section -->
                <div class="row mt-5">
                    <div class="col-4 text-center">
                        <div style="border-top: 1px solid black; display: inline-block; width: 200px; margin-top: 50px;">
                            Prepared By
                        </div>
                    </div>
                    <div class="col-4 text-center">
                        <div style="border-top: 1px solid black; display: inline-block; width: 200px; margin-top: 50px;">
                            HR Manager
                        </div>
                    </div>
                    <div class="col-4 text-center">
                        <div style="border-top: 1px solid black; display: inline-block; width: 200px; margin-top: 50px;">
                            Approved By
                        </div>
                    </div>
                </div>
            </div>
        </t>
    </t>
</template>